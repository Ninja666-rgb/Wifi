#include <ESP8266WiFi.h>
#include <DNSServer.h>
#include <ESP8266WebServer.h>

const byte DNS_PORT = 53;
IPAddress apIP(192, 168, 1, 1);
DNSServer dnsServer;
ESP8266WebServer webServer(80);

String responseHTML;

void defaultPage(){
  webServer.send(200, "text/html", F("<!DOCTYPE html> <html lang='en'> <head> <meta charset='UTF-8' /> <title>Checkbox Race!</title> <style>* { box-sizing: border-box; } html, body { margin: 0; padding: 0; } body { height: 100vh; display: flex; align-items: center; overflow: hidden; } input { transition: transform 100ms ease; cursor: pointer; } .toms { text-decoration: none; font-size: 20px; } .toms { display: inline-flex; align-items: center; justify-content: center; width: 33px; height: 33px; background-repeat: no-repeat; background-color: rgba(0, 0, 0, 0.07); border-radius: 50%; background-size: 20px 20px; background-position: center; vertical-align: top; } .checkboxes { height: 600px; display: flex; align-items: center; padding-left: calc(50vw - 10px); padding-right: calc(60vw); transition: transform 100ms ease; border-top: 3px dashed #f5f5f5; border-bottom: 3px dashed #f5f5f5; } .inner { padding-right: 30px; } .central { font-family: monospace; position: fixed; transform: translateX(-50%); pointer-events: none; left: 50%; font-weight: bold; display: flex; justify-content: center; align-items: center; transition: opacity 150ms ease-out; } .score { left: 0; padding: 30px; padding-right: 60px; height: 100vh; background: linear-gradient( 90deg, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 1) 80%, rgba(0, 0, 0, 0) 100% ); transform: none; text-align: center; font-size: 16px; line-height: 25px; color: white; } .score.show { color: black; } .tips { max-width: 150px; text-align: center; font-weight: bold; transform: translateY(-85%) translateX(-50%); } .flag { width: 25px; height: 25px; } .end { padding: 20px; background: #eee; margin-left: 20px; position: relative; font-family: monospace; width: 220px; text-align: center; display: flex; flex-direction: column; gap: 10px; transition: opacity 150ms ease-out; opacity: 0; } p { margin: 0; } .finalTime { font-weight: bold; } .nice { font-size: 18px; } .end:before { position: absolute; content: ''; left: -20px; top: 50%; margin-top: -10px; border-left: 10px solid transparent; border-right: 10px solid #eee; border-top: 10px solid transparent; border-bottom: 10px solid transparent; width: 20px; height: 20px; box-sizing: border-box; } .boost { position: absolute; pointer-events: none; animation: slideUp 800ms cubic-bezier(0.25, 1, 0.5, 1); opacity: 0; font-family: monospace; font-size: 15px; font-weight: bold; } .sitter { position: fixed; bottom: 15px; font-family: monospace; font-size: 11px; font-weight: bold; text-transform: uppercase; } .watch { background: rgba(0, 0, 0, 0.07); padding: 10px 15px; border-radius: 22px; display: inline-block; margin-right: 5px; } .twitter { background: url('data:image/png;base64,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'); width: 33px; height: 33px; display: inline-block; background-repeat: no-repeat; background-color: rgba(0, 0, 0, 0.07); border-radius: 50%; background-size: 20px 20px; background-position: center; vertical-align: top; } .left { left: 15px; } .right { right: 15px; } @keyframes slideUp { 0% { opacity: 1; transform: translateY(0) translateX(-50%); } 100% { opacity: 0; transform: translateY(-100px) translateX(-50%); } } .resetButton { width: 120px; margin: auto; margin-top: 2px; } .hide { opacity: 0; } .show { opacity: 1; }</style> </head> <body> <div class='checkboxes'> <input type='checkbox' scrollIndex='-1' /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <input type='checkbox' disabled /> <svg xmlns='http://www.w3.org/2000/svg' height='16' preserveAspectRatio='xMinYMin meet' viewBox='0 0 16 16' width='16' class='flag' > <path d='m7 3h2v5h-2v-1h-2v-1h-1v-1h1v-1h2z' fill='#f00' class='flagPiece' /> <path d='m8 8h1v2h1v1h2v2h-8v-2h2v-1h2z' /> </svg> <div class='end'> <b class='nice'>NICE!</b> <p>Your Time was <span class='finalTime'></span></p> <button class='resetButton'>reset</button> </div> </div> <div class='central score'> <div class='inner'> <span class='current'>000</span>/100<br /> <span class='timer'>00:00</span> </div> › </div> <div class='central tips'> Check the first box and we're off to the races! <br /><br />↯ </div> <div class='sitter left'> </div> <div class='sitter right'> </div> <script>const allCheckboxes = document.querySelectorAll('input'); const checkboxWrapper = document.querySelector('.checkboxes'); const scoreBoard = document.querySelector('.score'); const currentScore = document.querySelector('.current'); const tips = document.querySelector('.tips'); const timer = document.querySelector('.timer'); const flagPiece = document.querySelector('.flagPiece'); const finalTime = document.querySelector('.finalTime'); const resetButton = document.querySelector('.resetButton'); const endBoard = document.querySelector('.end'); const boostWords = [ 'Speed!', 'Nice!', 'Fast!', 'Power!', 'Great!', 'Awesome!', 'Amazing!', 'Super!', ]; resetButton.addEventListener('click', reset); setTimeout(() => { window.scrollTo(0, 0); }, 50); let animationFrame; let startTime; let currentIndex = 0; function startTimer() { startTime = Date.now(); animationFrame = window.requestAnimationFrame(tick); } function msToTime(duration) { var milliseconds = parseInt((duration % 1000) / 10) .toString() .padStart(2, '0'), seconds = Math.floor((duration / 1000) % 60), minutes = Math.floor((duration / (1000 * 60)) % 60), minutes = minutes < 10 ? '0' + minutes : minutes; seconds = seconds < 10 ? '0' + seconds : seconds; return minutes + ':' + seconds + ':' + milliseconds; } function tick() { var delta = Date.now() - startTime; timer.innerHTML = msToTime(delta); animationFrame = window.requestAnimationFrame(tick); } function randomPosOrNeg(number) { const posOrNeg = Math.random() < 0.5 ? -1 : 1; return Math.min(Math.random() * number, window.innerHeight - 10) * posOrNeg; } function reset() { allCheckboxes.forEach((checkbox, index) => { checkbox.style.transform = 'none'; if (index !== 0) { checkbox.disabled = true; } checkbox.checked = false; }); currentIndex = 0; checkboxWrapper.style.transform = `translateX(${-20 * currentIndex}px)`; currentScore.innerHTML = 0; tips.classList.remove('hide'); startTime = null; scoreBoard.classList.remove('show'); timer.innerHTML = '00:00:00'; flagPiece.style.fill = 'red'; endBoard.classList.remove('show'); } function addBoost(element) { let verticalMovement = new DOMMatrixReadOnly( window.getComputedStyle(element).transform ).f; const boostElement = document.createElement('div'); boostElement.classList.add('boost'); boostElement.style.top = `${ checkboxWrapper.clientHeight / 2 + verticalMovement - 60 }px`; boostElement.style.left = `${element.offsetLeft}px`; boostElement.innerHTML = boostWords[Math.floor(Math.random() * boostWords.length)]; checkboxWrapper.appendChild(boostElement); } document.body.addEventListener('click', () => { if (currentIndex === 0 || currentIndex === allCheckboxes.length) return; allCheckboxes[currentIndex].disabled = true; allCheckboxes[currentIndex - 1].checked = false; allCheckboxes[currentIndex - 1].disabled = false; currentIndex--; currentScore.innerText = currentIndex.toString().padStart(3, '0'); checkboxWrapper.style.transform = `translateX(${-20 * currentIndex}px)`; }); allCheckboxes.forEach((checkbox, index) => { checkbox.addEventListener('click', (event) => { if (!startTime) { startTimer(); } if (index === currentIndex) { if (currentIndex === 0) { tips.classList.add('hide'); scoreBoard.classList.add('show'); } event.stopPropagation(); if (Math.random() > 0.6) addBoost(checkbox); currentIndex++; currentScore.innerText = currentIndex.toString().padStart(3, '0'); if (currentIndex === allCheckboxes.length) { flagPiece.style.fill = '#00c800'; cancelAnimationFrame(animationFrame); scoreBoard.classList.remove('show'); var delta = Date.now() - startTime; finalTime.innerHTML = msToTime(delta); endBoard.classList.add('show'); return; } allCheckboxes[currentIndex].disabled = false; checkboxWrapper.style.transform = `translateX(${-20 * currentIndex}px)`; allCheckboxes[ currentIndex ].style.transform = `translateY(${randomPosOrNeg(5 + currentIndex)}px)`; } else if (currentIndex === allCheckboxes.length) { if (currentIndex === allCheckboxes.length) { event.stopPropagation(); event.preventDefault(); } } }); });</script> </body> </html>"));
}

void setup() {
  pinMode(LED_BUILTIN, OUTPUT);
  WiFi.mode(WIFI_AP);
  WiFi.softAPConfig(apIP, apIP, IPAddress(255, 255, 255, 0));
  WiFi.softAP("Checkbox race");
  dnsServer.start(DNS_PORT, "*", apIP);
  webServer.onNotFound(defaultPage);
  webServer.begin();
}

void loop() {
  if (WiFi.softAPgetStationNum() == 0)
  {
    delay(100);
  } else {
    delay(100);
    dnsServer.processNextRequest();
    webServer.handleClient();
  }
}
